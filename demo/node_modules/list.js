const bel = require('bel')
const csjs = require('csjs-inject')
const file = require('path').basename(__filename)
const style_sheet = require('../../src/node_modules/support-style-sheet')
const button = require('../../src/index')

module.exports = i_list

function i_list ({page = 'Demo', flow = 'ui-list', name, body = [], is_expanded = false, is_hidden }, protocol) {
    const recipients = [] 
    const sender = protocol( get )
    sender({page, from: name, flow, type: 'ready', file, fn: 'i_list', line: 12})
    const list = document.createElement('i-list')
    list.setAttribute('role', 'listbox')
    list.ariaHidden = false
    list.ariaLabel = name
    list.tabIndex = 0

    try {
        body.map( (option, i) => {
            const {text, icon} = option
            const selected = i === 0 ? true : false
            // todo: make button into list
            var item = button({page, name: text, body: text, icon, isSelected: selected, theme: { props: { bg_color: 'transparent', bg_color_hover: 'transparent'}}}, button_protocol(text))
            const li = bel`<li role="option" data-option=${text.toLowerCase()}">${item}</li>`
            list.append(li)
            if (i === 0) list.setAttribute('aria-activedescendant', text)
        })
        if (body.length === 0) sender({from: name, flow, type: 'error', body: 'body no items', fn: 'i_list', file, line: 25})
    } catch(e) {
        sender({from: name, flow, type: 'error', body: 'something went wrong', fn: 'i_list', file, line: 27})
    }
    
    return list

    function button_protocol (name) {
        return (sender) => {
            recipients[name] = sender
            return (msg) => {
                const {page, flow, from: name, type, body, fn} = msg
                console.log( msg );
                sender(msg)
            }
        }
    }

    function get (msg) {
        console.log( msg );
    }
}